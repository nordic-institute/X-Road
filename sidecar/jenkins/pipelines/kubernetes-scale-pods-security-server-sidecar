pipeline {
    agent { label 'dev-test' }
    parameters {
        string(description: "Number of pod replicas", name: "NUMBER_REPLICAS", defaultValue: "${params?.NUMBER_REPLICAS}")
        string(description: "Sidecar version", name: "VERSION", defaultValue: "${params?.VERSION}")
    }
    stages {
        stage('Scale replicas') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'AWS', usernameVariable: 'AWS_ACCESS_KEY_ID', passwordVariable: 'AWS_SECRET_ACCESS_KEY')]) {                 
                    sh 'kubectl scale --replicas=${NUMBER_REPLICAS} deployment.v1.apps/security-server-sidecar-${VERSION}'
                }
            }
        }
    }
}