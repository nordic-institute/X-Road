<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">

    <changeSet id="apikey-testdata" author="ricardas">
        <comment>Add default apiKey which can be used for scenarios which do not case about permissions.
        </comment>
        <sql>
            -- noinspection SqlResolve
            INSERT INTO apikey
                (id, encodedkey)
            VALUES (1, 'ad26a8235b3e847dc0b9ac34733d5acb39e2b6af634796e7eebe171165cdf2d1'), -- d56e1ca7-4134-4ed4-8030-5f330bdb602a
                   (2, 'ed99ce2b1660cb681598b9d33bb84089f3023d6f511729a281066bed5a764ca0'), -- 4a5842e5-4ede-49f1-ab32-1b6be33d81c3
                   (3, 'e26a8562ff905ba186970fb889b429eab2ceb8195b81e58767dd170ca910583d'), -- 3964334d-1f65-4629-a4a4-73c62ade0c9c
                   (4, 'ccba0161478071cbd9801d981e74465d54d963563afc7713513698e1173a76f0'); -- de628164-9485-409c-b654-7dda28bb3872

            INSERT INTO apikey_roles
                (id, apikey_id, role)
            VALUES (1000001, 1, 'XROAD_SYSTEM_ADMINISTRATOR'),
                   (1000002, 2, 'XROAD_REGISTRATION_OFFICER'),
                   (1000003, 3, 'XROAD_SECURITY_OFFICER'),
                   (1000004, 4, 'XROAD_MANAGEMENT_SERVICE');
            ALTER SEQUENCE apikey_roles_id_seq RESTART WITH 1001000;
        </sql>
    </changeSet>

    <changeSet id="internal-configuration-testdata" author="vpaliliunas">
        <comment>Test data for configuration info apis testing
        </comment>
        <sql>
            <![CDATA[
            -- noinspection SqlResolve
            INSERT INTO configuration_sources
            (source_type, active_key_id, anchor_file, anchor_file_hash, anchor_generated_at, ha_node_name)
            VALUES ('internal', null,
                    decode('3c3f786d6c2076657273696f6e3d22312e302220656e636f64696e673d225554462d3822207374616e64616c6f6e653d22796573223f3e0a3c6e73333a636f6e66696775726174696f6e416e63686f7220786d6c6e733a6e73323d22687474703a2f2f782d726f61642e65752f7873642f6964656e746966696572732220786d6c6e733a6e73333d22687474703a2f2f782d726f61642e65752f7873642f78726f61642e787364223e0a202020203c67656e65726174656441743e323032312d30332d31305430373a34303a35312e3730395a3c2f67656e65726174656441743e0a202020203c696e7374616e63654964656e7469666965723e43533c2f696e7374616e63654964656e7469666965723e0a202020203c736f757263653e0a20202020202020203c646f776e6c6f616455524c3e687474703a2f2f63732f696e7465726e616c636f6e663c2f646f776e6c6f616455524c3e0a20202020202020203c766572696669636174696f6e436572743e4d49494371544343415a476741774942416749424154414e42676b71686b694739773042415130464144414f4d517777436759445651514444414e4f4c3045774868634e4e7a41774d5441784d4441774d4441775768634e4d7a67774d5441784d4441774d444177576a414f4d517777436759445651514444414e4f4c304577676745694d4130474353714753496233445145424151554141344942447741776767454b416f49424151436e773432762b4377504e6d49376a323443305548734e666878444b6134726b7067716b34694b6e513543797a537876656f64626475417a2b68326c484f485470496e4f6774695964384355544a552f413955304a575438574134794f5765414c786772526c416d52393434627754444b654748764a6e6955376552396850306d4b6458785055745a4f5030455265366e71484957472f66324e415832537836646757766f394e426e585a2f336c5161676155486b346d7a7456666b346a4e35457a42716b6772332f326f586b582f4f2f4d336855324f714e6f51536c484e627554456b6f776b52576b553755474b626b4575532b6c646d625957765443656151734a6e6a4e2b4b76447971544665783655586b7236396c376b4d44754e6c59787273456658632b35597936535a65676c574967694b2b63677261394537546636454a6d5a5177486b4d61303078542b346f416b372f41674d424141476a456a41514d41344741315564447745422f775145417749475144414e42676b71686b6947397730424151304641414f43415145414d554e36356d577166382f50794963715971364f4d4530444e4165526e333049372f69634c6875756d47454863645953737a65453839417452692b4b454675316c4b6a3472416e3648612b36304a502f3362494d74713830377231563652547736325a4849515462423268587151544974625749636e4e71557530525665717445304b4c6b7a314b2f73792b2b55705961626b6c2b7357516d345137727449724763476f4d493939376b32685a317679636648502f424a367a76316842693434616c387677512b623633784d634a58474c555a557230634d50424977776e6445554e316e6f656574622b4a454d6f425259677344634f70587a41645a4f624c556f542b53457755733968395a483031573056767a395831516147457765312b4c6d37484a78474f4f446a432b6f50535362513279782b56334f4d7133315a6a69394765544977366c3569542b7776796b6a54697958413d3d3c2f766572696669636174696f6e436572743e0a202020203c2f736f757263653e0a3c2f6e73333a636f6e66696775726174696f6e416e63686f723e0a', 'hex'),
                    '4D:72:A8:60:90:88:A2:5B:9C:6B:91:86:3C:D7:44:CE:9E:E1:1C:27:8E:33:F4:E5:31:68:F2:EC',
                    '2022-01-01 01:00:00.000000', 'test_node');

            INSERT INTO configuration_sources
            (source_type, active_key_id, anchor_file, anchor_file_hash, anchor_generated_at, ha_node_name)
            VALUES ('external', null,
                    decode('3c3f786d6c2076657273696f6e3d22312e302220656e636f64696e673d225554462d3822207374616e64616c6f6e653d22796573223f3e0a3c6e73333a636f6e66696775726174696f6e416e63686f7220786d6c6e733a6e73323d22687474703a2f2f782d726f61642e65752f7873642f6964656e746966696572732220786d6c6e733a6e73333d22687474703a2f2f782d726f61642e65752f7873642f78726f61642e787364223e0a20203c67656e65726174656441743e323032312d30332d31305430373a34303a35372e3431315a3c2f67656e65726174656441743e0a20203c696e7374616e63654964656e7469666965723e43533c2f696e7374616e63654964656e7469666965723e0a20203c736f757263653e0a202020203c646f776e6c6f616455524c3e687474703a2f2f63732f65787465726e616c636f6e663c2f646f776e6c6f616455524c3e0a202020203c766572696669636174696f6e436572743e4d49494371544343415a476741774942416749424154414e42676b71686b694739773042415130464144414f4d517777436759445651514444414e4f4c3045774868634e4e7a41774d5441784d4441774d4441775768634e4d7a67774d5441784d4441774d444177576a414f4d517777436759445651514444414e4f4c304577676745694d4130474353714753496233445145424151554141344942447741776767454b416f494241514342554e6a397a7547425a596769513171346a78655079374370653862627233372b79536e6a6b514b6c384430472f36764972505a50717a3252526b3151614b6d5631776b466c63436b7379752b305156506e706d6a525936416c6b5752524363695432316a434870436566396b776a542b2b4e7755415638674a2b736f497161735755435a704a5045446b435672422b2f6a4f3232576c74647a70716d6a337958324e317a524947366464716f4f49657a355730633273747937773173486e432b6164466f424957735a63744e48664c6c496e4b456b5374546137385854724b38456e6a5238717a705a56596a683057784f5a764e376f714e5a4464556765473367423239544c706a326f34482f725462556c674a54306742532f414849784d7a525055624d566165444e476170364f666a652f384a633174624f644c35776a596339705962553570777a2f6f53474d493674614241674d424141476a456a41514d41344741315564447745422f775145417749475144414e42676b71686b6947397730424151304641414f434151454155564d2b776f415245776b4b46593175455a564f53484e7931536c7a72454a443367506d2f75692b5939334c76477243537277564a5655716433646b623949734844364a65762f53586a45462f706847565679305748533845584a706b4c4764562f6c526c2f546e685a7651366b377135616d556434336278494862334a706e347a33667057675830372f6f7033534f575342534b564f44346d72684951516b774a514b54536b6a464458724a45696a596379542b72675555654f57694e536e6269376e476e42674a6c4941356666316f6a6d62396b426946554e533374485947306865456b583436727336416c3967716a5a746169444b36586b5a776c6b71783736394c7a78526c6e6c72554c7a5170573153774579455164567a5a502f6b7153737166794d4e6d656f6b4f31686b2b467446766f5269335847317545594a4f2b4d386f50766f39392b47797534354951726d69673d3d3c2f766572696669636174696f6e436572743e0a20203c2f736f757263653e0a3c2f6e73333a636f6e66696775726174696f6e416e63686f723e', 'hex'),
                    '4D:72:A8:60:90:88:A2:5B:9C:6B:91:86:3C:D7:44:CE:9E:E1:1C:27:8E:33:F4:E5:31:68:F2:EC',
                    '2022-01-01 01:00:00.000000', 'test_node');

            INSERT INTO distributed_files
            (version, file_name, file_data, content_identifier, file_updated_at, ha_node_name)
            VALUES (2, 'shared-params.xml', '<conf/>', 'SHARED-PARAMETERS', '2022-01-01 01:00:00.000000', 'test_node'),
                   (2, 'private-params.xml', '<conf/>', 'PRIVATE-PARAMETERS', '2022-01-01 01:00:00.000000', 'test_node'),
                   (0, 'test-fetchinterval-part.xml', '<conf/>', 'FETCHINTERVAL', '2022-01-01 01:00:00.000000', 'test_node');
            ]]>
        </sql>
    </changeSet>

    <changeSet id="security-server-owners-global-group" author="justass">
        <comment>Create security-server-owners global group.</comment>
        <sql>
            INSERT INTO global_groups(group_code, description, created_at, updated_at)
            VALUES ('security-server-owners','Security server owners', now(), now());
        </sql>
    </changeSet>

    <changeSet id="add-configuration-signing-keys" author="ovidijus">
        <comment>Add signing keys for configuration sources.</comment>
        <sql>
            INSERT INTO configuration_signing_keys
                (configuration_source_id, key_identifier, cert, key_generated_at, token_identifier)
            VALUES (
                    (SELECT id FROM configuration_sources WHERE source_type = 'internal'),
                    'F397AF7369B15D42D7190E90ECA9508D48275FAB',
                    E'\\x308202A930820191A003020102020101300D06092A864886F70D01010D0500300E310C300A06035504030C034E2F41301E170D3730303130313030303030305A170D3338303130313030303030305A300E310C300A06035504030C034E2F4130820122300D06092A864886F70D01010105000382010F003082010A0282010100A7C38DAFF82C0F36623B8F6E02D141EC35F8710CA6B8AE4A60AA4E222A74390B2CD2C6F7A875B76E033FA1DA51CE1D3A489CE82D89877C0944C953F03D5342564FC580E323967802F182B46502647DE386F04C329E187BC99E253B791F613F498A757C4F52D64E3F41117BA9EA1C8586FDFD8D017D92C7A7605AFA3D3419D767FDE541A81A5079389B3B557E4E2337913306A920AF7FF6A17917FCEFCCDE15363AA36841294735BB93124A309115A453B50629B904B92FA57666D85AF4C279A42C2678CDF8ABC3CAA4C57B1E945E4AFAF65EE4303B8D958C6BB047D773EE58CBA4997A095622088AF9C82B6BD13B4DFE84266650C0790C6B4D314FEE28024EFF0203010001A3123010300E0603551D0F0101FF040403020640300D06092A864886F70D01010D0500038201010031437AE665AA7FCFCFC8872A62AE8E304D033407919F7D08EFF89C2E1BAE98610771D612B33784F3D02D462F8A105BB594A8F8AC09FA1DAFBAD093FFDDB20CB6AF34EEBD55E914F0EB66472104DB076857A904C8B5B58872736A52ED1155EAAD13428B933D4AFECCBEF94A5869B925FAC5909B843BAED22B19C1A8308F7DEE4DA1675BF271F1CFFC127ACEFD61062E386A5F2FC10F9BEB7C4C7095C62D4654AF470C3C1230C2774450DD67A1E7AD6FE244328051620B0370EA57CC075939B2D4A13F9213052CF61F591F4D56D15BF3F57D506861307B5F8B9BB1C9C4638E0E30BEA0F4926D0DB2C7E57738CAB7D598E2F46793230EA5E624FEC2FCA48D38B25C',
                    '2022-01-02 01:00:00.000000',
                    '0');

            INSERT INTO configuration_signing_keys
            (configuration_source_id, key_identifier, cert, key_generated_at, token_identifier)
            VALUES (
                           (SELECT id FROM configuration_sources WHERE source_type = 'external'),
                           'BAE59C0FA417D2CD65FAB7DB5E493D0D6053B777',
                           E'\\x308202A930820191A003020102020101300D06092A864886F70D01010D0500300E310C300A06035504030C034E2F41301E170D3730303130313030303030305A170D3338303130313030303030305A300E310C300A06035504030C034E2F4130820122300D06092A864886F70D01010105000382010F003082010A02820101008150D8FDCEE181658822435AB88F178FCBB0A97BC6DBAF7EFEC929E39102A5F03D06FFABC8ACF64FAB3D91464D5068A995D7090595C0A4B32BBED1054F9E99A3458E809645914427224F6D63087A4279FF64C234FEF8DC14015F2027EB2822A6AC594099A493C40E4095AC1FBF8CEDB65A5B5DCE9AA68F7C97D8DD734481BA75DAA83887B3E56D1CDACB72EF0D6C1E70BE69D1680485AC65CB4D1DF2E5227284912B536BBF174EB2BC1278D1F2ACE96556238745B1399BCDEE8A8D64375481E1B7801DBD4CBA63DA8E07FEB4DB5258094F48014BF00723133344F51B31569E0CD19AA7A39F8DEFFC25CD6D6CE74BE708D873DA586D4E69C33FE8486308EAD6810203010001A3123010300E0603551D0F0101FF040403020640300D06092A864886F70D01010D0500038201010051533EC2801113090A158D6E11954E487372D52973AC4243DE03E6FEE8BE63DDCBBC6AC24ABC1525552A7777646FD22C1C3E897AFFD25E3105FE9846555CB45874BC11726990B19D57F95197F4E7859BD0EA4EEAE5A994778DDBC481DBDC9A67E33DDFA56817D3BFE8A7748E592052295383E26AE1210424C0940A4D29231435EB2448A361CC93FAB81451E39688D4A76E2EE71A7060265200E5F7F5A2399BF64062154352DED1D81B485E1245F8EABB3A025F60AA366D6A20CAE97919C2592AC7BEBD2F3C5196796B50BCD0A56D52C04C8441D57364FFE4A92B2A7F230D99EA243B5864F85B45BE8462DD71B5B846093BE33CA0FBE8F7DF86CAEE39210AE68A',
                           '2022-01-02 01:00:00.000000',
                           '0');
            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'F397AF7369B15D42D7190E90ECA9508D48275FAB') WHERE source_type = 'internal';
            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'BAE59C0FA417D2CD65FAB7DB5E493D0D6053B777') WHERE source_type = 'external';

            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'F397AF7369B15D42D7190E90ECA9508D48275FAB') WHERE source_type = 'internal';
            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'BAE59C0FA417D2CD65FAB7DB5E493D0D6053B777') WHERE source_type = 'external';
        </sql>
    </changeSet>
</databaseChangeLog>
