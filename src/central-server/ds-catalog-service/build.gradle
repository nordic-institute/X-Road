import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar

plugins {
    id("java")
    id("application")
    id("com.github.johnrengelman.shadow")
}

configurations {
    sqlDependencies

    configureEach {
        exclude group: 'org.eclipse.edc', module: 'jetty-core'
        //exclude group: 'org.eclipse.edc', module: 'token-core'
    }

}

dependencies {
    implementation("org.eclipse.jetty.websocket:websocket-jakarta-server:$edcJettyVersion")

    implementation("org.eclipse.edc:util:$edcVersion")
    implementation("org.eclipse.edc:configuration-filesystem:$edcVersion")
    implementation("org.eclipse.edc:vault-filesystem:$edcVersion")
    implementation("org.eclipse.edc:dsp:$edcVersion")

    implementation("org.eclipse.edc:json-ld-spi:$edcVersion")
    implementation("org.eclipse.edc:control-plane-api-client:$edcVersion")
    implementation("org.eclipse.edc:control-plane-core:$edcVersion")
    implementation("org.eclipse.edc:data-plane-core:$edcVersion")

    implementation("org.eclipse.edc:api-observability:$edcVersion")
    implementation("org.eclipse.edc:control-plane-api-client:$edcVersion")

    // federated catalog
    implementation("org.eclipse.edc:federated-catalog-core:$edcVersion")
    implementation("org.eclipse.edc:federated-catalog-api:$edcVersion")

    // trust
    // embedded Identity Hub
    implementation("org.eclipse.edc:identity-hub-api:$edcVersion")
    implementation("org.eclipse.edc:identity-hub-credentials:$edcVersion")
    implementation("org.eclipse.edc:identity-hub-participants:$edcVersion")
    implementation("org.eclipse.edc:identity-hub-keypairs:$edcVersion")
    implementation("org.eclipse.edc:identity-hub-did:$edcVersion")

    implementation("org.eclipse.edc:identity-trust-core:$edcVersion")
    implementation("org.eclipse.edc:identity-did-core:$edcVersion")
    implementation("org.eclipse.edc:identity-did-web:$edcVersion")
    implementation("org.eclipse.edc:identity-trust-issuers-configuration:$edcVersion")

    implementation(project(":security-server:edc:extensions:xroad-identity-and-trust"))
    implementation(project(":security-server:edc:extensions:xroad-webserver"))

    testImplementation("org.eclipse.edc:junit:$edcVersion")
    testImplementation(project(':common:common-test')) {
        exclude group: 'org.eclipse.jetty'
    }
}

application {
    mainClass.set("org.eclipse.edc.boot.system.runtime.BaseRuntime")
}


var distTar = tasks.named("distTar")
var distZip = tasks.named("distZip")

shadowJar {
    mergeServiceFiles()
    archiveFileName.set("ds-catalog-service.jar")
    dependsOn(distTar, distZip)
}

