dependencies {
  intTestImplementation project(":security-server:openapi-model")

  intTestImplementation("com.nortal.test:test-automation-core:${testAutomationFrameworkVersion}")
  intTestImplementation("com.nortal.test:test-automation-selenide:${testAutomationFrameworkVersion}")
  intTestImplementation("com.nortal.test:test-automation-allure:${testAutomationFrameworkVersion}")
  intTestImplementation("com.nortal.test:test-automation-containers:${testAutomationFrameworkVersion}")
  intTestImplementation("com.nortal.test:test-automation-feign:$testAutomationFrameworkVersion")
  intTestImplementation("org.bouncycastle:bcpkix-jdk15on:${bouncyCastleVersion}")
  intTestImplementation("org.awaitility:awaitility:${awaitilityVersion}")
}

task systemTest(type: Test) {
  useJUnitPlatform()

  setDescription("Runs system ui tests.")
  group = 'verification'

  testClassesDirs = sourceSets.intTest.output.classesDirs
  classpath = sourceSets.intTest.runtimeClasspath

  def systemTestArgs = ["-XX:MaxMetaspaceSize=200m"]
  if (project.hasProperty('systemTestSsTags')) {
    systemTestArgs += "-Dtest-automation.cucumber.filter.tags=" + project.getProperty('systemTestTags')
  }
  if (project.hasProperty('systemTestSsServeReport')) {
    systemTestArgs += "-Dtest-automation.report.allure.serve-report.enabled=" + project.getProperty('systemTestServeReport')
  }
  if (project.hasProperty('systemTestSsPackageHost')) {
    systemTestArgs += "-Dtest-automation.custom.package-host=" + project.getProperty('systemTestSsPackageHost')
  }
  if (project.hasProperty('systemTestSsDockerRoot')) {
    systemTestArgs += "-Dtest-automation.custom.docker-root=" + project.getProperty('systemTestSsDockerRoot')
  }
  jvmArgs systemTestArgs

  maxHeapSize("256m")

  testLogging {
    showStackTraces(true)
    showExceptions(true)
    showCauses(true)
    showStandardStreams(true)
  }

  shouldRunAfter test
}
