plugins {
    alias(libs.plugins.shadow)
}

dependencies {
    implementation(project(':addons:messagelog:messagelog-addon:core'))
    implementation(project(':addons:messagelog:messagelog-addon:asic'))

    testImplementation project(':common:common-jetty')
    testImplementation project(':common:common-globalconf')
    testImplementation project(':common:common-scheduler')
    testImplementation project(':common:common-message')
    testImplementation project(':common:common-messagelog')
    testImplementation project(':common:common-verifier')
    testImplementation project(':serverconf')
    testImplementation project(':asic-util')
    testImplementation project(':proxy:application')

    testImplementation project(':common:common-keyconf')
    testImplementation project(':common:common-test')
    testImplementation project(':addons:messagelog:messagelog-archiver')
    testImplementation libs.hsqldb
    testImplementation libs.bouncyCastle.bcpg
    testImplementation libs.dss.asic.xades
}

jar {
    from project(':addons:messagelog:messagelog-db').sourceSets.main.output
}

shadowJar {
    archiveVersion = ''
    archiveClassifier = ''
    from project(':addons:messagelog:messagelog-db').sourceSets.main.output
    from project(':addons:messagelog:messagelog-addon:core').sourceSets.main.output
    from project(':addons:messagelog:messagelog-addon:asic').sourceSets.main.output
}

tasks.register('copyGpg', Copy) {
    from 'src/test/gpg'
    into layout.buildDirectory.dir("gpg")
}

archUnit {
    skip = true
}

test.dependsOn copyGpg
assemble.dependsOn shadowJar
