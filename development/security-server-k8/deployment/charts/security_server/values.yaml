# values.yaml
global:
  environment: dev
  dataSpacesEnabled: false

#TODO for now this purely for temporary cert init
serviceAccount:
  name: "ss-init-sa"
  create: true

readinessProbe:
  default:
    path: /actuator/health
    port: http  # Use named port
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 1
    successThreshold: 1
    failureThreshold: 3

init:
  serverconf:
    image: xroad-ss-serverconf-init:latest
    host: "db-serverconf.ss.svc.cluster.local"
    port: "5432"
    database: "serverconf"
    username: "replace-me"
    password: "replace-me"
    schema: "public"
  messagelog:
    image: xroad-ss-messagelog-init:latest
    host: "db-messagelog.ss.svc.cluster.local"
    port: "5432"
    database: "messagelog"
    username: "replace-me"
    password: "replace-me"
    schema: "public"
  dsControlPlane:
    dsComponent: true
    image: xroad-ss-ds-control-plane-db-init:latest
    host: "db-ds-control-plane.ss.svc.cluster.local"
    port: "5432"
    database: "ds-control-plane"
    username: "replace-me"
    password: "replace-me"
    schema: "public"
  dsDataPlane:
    dsComponent: true
    image: xroad-ss-ds-data-plane-db-init:latest
    host: "db-ds-data-plane.ss.svc.cluster.local"
    port: "5432"
    database: "ds-data-plane"
    username: "replace-me"
    password: "replace-me"
    schema: "public"
  dsIdentityHub:
    dsComponent: true
    image: xroad-ss-ds-identity-hub-db-init:latest
    host: "db-ds-identity-hub.ss.svc.cluster.local"
    port: "5432"
    database: "ds-identity-hub"
    username: "replace-me"
    password: "replace-me"
    schema: "public"

services:
  configuration-client:
    image: xroad-ss-confclient:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 320Mi
    ports:
      - port: 5799
        name: http
      - port: 5665
        name: grpc
    serviceAccount:
      annotations: { }
    env:
      SERVER_PORT: "5799"
      XROAD_HOST: "configuration-client.ss.svc.cluster.local"
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
      XROAD_SECRET_STORE_SKIP_SSL: "true"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"

  signer:
    image: xroad-ss-signer:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 320Mi
    ports:
      - port: 5699
        name: http
      - port: 5560
        name: grpc
    serviceAccount:
      annotations: { }
    env:
      SERVER_PORT: "5699"
      XROAD_HOST: "signer.ss.svc.cluster.local"
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"

  proxy:
    image: xroad-ss-proxy-qrk:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 9000
        name: http
      - port: 5567
        name: grpc
      - port: 8443
        name: proxy-http
    serviceAccount:
      annotations: { }
    env:
      XROAD_HOST: "proxy.ss.svc.cluster.local"
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
    volumeMounts:
      - name: ssl-certs
        mountPath: /etc/xroad/ssl
        readOnly: false
    volumes:
      - name: ssl-certs
        persistentVolumeClaim:
          claimName: ss-ssl-certs
    readinessProbe:
      path: /q/health/ready
  proxy-ui-api:
    image: xroad-ss-ui:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 4000
        name: http
    debugPort: 9999
    serviceAccount:
      annotations: { }
    env:
      SERVER_PORT: "4000"
      DEBUG_PORT: "9999"
      XROAD_HOST: "proxy-ui-api.ss.svc.cluster.local"
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
    volumeMounts:
      - name: ssl-certs
        mountPath: /etc/xroad/ssl
        readOnly: false
    volumes:
      - name: ssl-certs
        persistentVolumeClaim:
          claimName: ss-ssl-certs
  messagelog-archiver:
    image: xroad-ss-messagelog-archiver:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 5598
        name: http
    debugPort: 9999
    serviceAccount:
      annotations: { }
    env:
      DEBUG_PORT: "9999"
      XROAD_HOST: "messagelog-archiver.ss.svc.cluster.local"
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
  monitor:
    image: xroad-ss-monitor:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 5999
        name: http
    debugPort: 9999
    serviceAccount:
      annotations: { }
    env:
      DEBUG_PORT: "9999"
      XROAD_HOST: "monitor.ss.svc.cluster.local"
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
  op-monitor:
    image: xroad-ss-op-monitor:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 5899
        name: http
    debugPort: 9999
    serviceAccount:
      annotations: { }
    env:
      DEBUG_PORT: "9999"
      XROAD_HOST: "op-monitor.ss.svc.cluster.local"
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
  ds-data-plane:
    dsComponent: true
    image: xroad-ss-ds-data-plane:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 5850
        name: http
    debugPort: 9999
    serviceAccount:
      annotations: { }
    env:
      DEBUG_PORT: "9999"
      XROAD_HOST: "ds-data-plane.ss.svc.cluster.local"
      EDC_HOSTNAME: "ds-data-plane.ss.svc.cluster.local"
      EDC_DID: "did:web:ds-identity-hub.ss.svc.cluster.local%3A9396" #TODO this is most surely wrong
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
  ds-control-plane:
    dsComponent: true
    image: xroad-ss-ds-control-plane:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 5851
        name: http
    debugPort: 9999
    serviceAccount:
      annotations: { }
    env:
      DEBUG_PORT: "9999"
      XROAD_HOST: "ds-control-plane.ss.svc.cluster.local"
      EDC_HOSTNAME: "ds-control-plane.ss.svc.cluster.local"
      EDC_DID: "did:web:ds-identity-hub.ss.svc.cluster.local%3A9396" #TODO this is most surely wrong
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
  ds-identity-hub:
    dsComponent: true
    image: xroad-ss-ds-identity-hub:latest
    imagePullPolicy: Never
    resources:
      requests:
        memory: 64Mi
      limits:
        memory: 512Mi
    ports:
      - port: 5798
        name: http
    debugPort: 9999
    serviceAccount:
      annotations: { }
    env:
      DEBUG_PORT: "9999"
      XROAD_HOST: "ds-identity-hub.ss.svc.cluster.local"
      EDC_HOSTNAME: "ds-identity-hub.ss.svc.cluster.local"
      EDC_DID: "did:web:ds-identity-hub.ss.svc.cluster.local%3A9396" #TODO this is most surely wrong
      XROAD_SECRET_STORE_HOST: "openbao.ss.svc.cluster.local"
      XROAD_SECRET_STORE_SCHEME: "http"
    envFromSecrets:
      - name: "XROAD_SECRET_STORE_TOKEN"
        secretName: "xroad-token"
        key: "XROAD_SECRET_STORE_TOKEN"
