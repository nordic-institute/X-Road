services:
  cs:
    build:
      context: ../centralserver/build
      dockerfile: ../Dockerfile
      args:
        REPO: packages
    healthcheck: 
      test: ["CMD", "curl", "-f", "-k", "https://localhost:4000"]
    ports:
      - "4001:4000"
      - "8088:8888"
    volumes:
      - ca-volume:/home/ca/
  ssm:
    build:
      context: ../securityserver
      args:
        REPO: packages
    healthcheck: 
      test: ["CMD", "curl", "-f", "-k", "https://localhost:4000"]
    ports:
      - "4002:4000"
  ss1:
    build:
      context: ../securityserver
      args:
        REPO: packages
    healthcheck: 
      test: ["CMD", "curl", "-f", "-k", "https://localhost:4000"]
    ports:
      - "4003:4000"
  ss2:
    build:
      context: ../securityserver
      args:
        REPO: packages
    healthcheck: 
      test: ["CMD", "curl", "-f", "-k", "https://localhost:4000"]
    ports:
      - "4004:4000"
  exadapter:
    image: niis/example-adapter 
    healthcheck:
      test: ["CMD", "curl", "-f", "-k", "http://localhost:8080/example-adapter/Endpoint?wsdl"]
  hurl:
    build: .
    volumes:
      - ./hurl-src:/hurl-src
      - ca-volume:/hurl-files/ca
    depends_on:
      cs:
        condition: service_healthy
      ssm:
        condition: service_healthy
      ss1:
        condition: service_healthy
      exadapter:
        condition: service_healthy
volumes:
  ca-volume:
